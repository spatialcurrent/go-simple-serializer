// =================================================================
//
// Copyright (C) 2019 Spatial Current, Inc. - All Rights Reserved
// Released as open source under the MIT License.  See LICENSE file.
//
// =================================================================

package rapid

import (
	"bytes"
	"testing"

	"github.com/stretchr/testify/require"
)

func TestDecodeGeoJSON(t *testing.T) {
	in := []byte{
		0x0, 0x80, 0x2, 0x4, 0x67, 0x65, 0x6f, 0x6d, 0x65, 0x74, 0x72, 0x79, 0x0,
		0x69, 0x64, 0x0, 0x70, 0x72, 0x6f, 0x70, 0x65, 0x72, 0x74, 0x69, 0x65, 0x73,
		0x0, 0x74, 0x79, 0x70, 0x65, 0x0, 0x0, 0x80, 0x2, 0x2, 0x63, 0x6f, 0x6f,
		0x72, 0x64, 0x69, 0x6e, 0x61, 0x74, 0x65, 0x73, 0x0, 0x74, 0x79, 0x70,
		0x65, 0x0, 0x0, 0x2, 0x2, 0xce, 0x82, 0xf5, 0x24, 0x55, 0x1c, 0x22,
		0x40, 0x78, 0xe4, 0x59, 0x93, 0xb8, 0x0, 0x49, 0x40, 0x10, 0x50, 0x6f,
		0x69, 0x6e, 0x74, 0x0, 0x2, 0x1, 0x0, 0x80, 0x2, 0x2, 0x69, 0x64, 0x0,
		0x6e, 0x61, 0x6d, 0x65, 0x0, 0x2, 0x1, 0x10, 0x48, 0x65, 0x6c, 0x6c,
		0x6f, 0x20, 0x57, 0x6f, 0x72, 0x6c, 0x64, 0x0, 0x10, 0x46, 0x65, 0x61,
		0x74, 0x75, 0x72, 0x65, 0x0,
	}
	expected := map[string]interface{}{
		"type": "Feature",
		"id":   1,
		"properties": map[string]interface{}{
			"id":   1,
			"name": "Hello World",
		},
		"geometry": map[string]interface{}{
			"type":        "Point",
			"coordinates": []interface{}{9.0553371, 50.0056328},
		},
	}
	decoder := NewDecoder(bytes.NewReader(in), '\n', true)
	// decode first object
	m := map[string]interface{}{}
	err := decoder.Decode(&m)
	require.NoError(t, err)
	require.Equal(t, expected, m)
}
